<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Language Detection Demo - Intel Sustainability</title>
  <!-- Bootstrap CSS (will be dynamically switched) -->
  <link id="bootstrap-css" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <style>
    .demo-box {
      border: 2px solid #0071c5;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
    }
    .status-indicator {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 8px;
    }
    .status-rtl { background-color: #28a745; }
    .status-ltr { background-color: #0071c5; }
  </style>
</head>
<body>
  <div class="container py-5">
    <h1 class="mb-4"><i class="bi bi-translate"></i> Language Detection Demo</h1>
    
    <div class="alert alert-info">
      <h5><i class="bi bi-info-circle"></i> How It Works</h5>
      <p>This demo shows the automatic RTL/LTR detection system. Use the buttons below to switch languages and watch the layout change automatically!</p>
    </div>

    <!-- Status Display -->
    <div class="demo-box">
      <h3>Current Status</h3>
      <p><strong>Language:</strong> <span id="current-lang">en</span></p>
      <p><strong>Direction:</strong> 
        <span class="status-indicator" id="status-indicator"></span>
        <span id="current-dir">LTR</span>
      </p>
      <p><strong>Bootstrap CSS:</strong> <span id="current-css">Standard (LTR)</span></p>
    </div>

    <!-- Manual Language Switcher -->
    <div class="demo-box">
      <h3>Manual Language Switcher</h3>
      <p>Click any button to switch the page language:</p>
      
      <div class="row g-2">
        <!-- LTR Languages -->
        <div class="col-12 col-md-6">
          <h5>LTR Languages</h5>
          <button class="btn btn-primary btn-sm me-2 mb-2" onclick="switchLanguage('en')">
            English (en)
          </button>
          <button class="btn btn-primary btn-sm me-2 mb-2" onclick="switchLanguage('es')">
            Español (es)
          </button>
          <button class="btn btn-primary btn-sm me-2 mb-2" onclick="switchLanguage('fr')">
            Français (fr)
          </button>
          <button class="btn btn-primary btn-sm me-2 mb-2" onclick="switchLanguage('de')">
            Deutsch (de)
          </button>
          <button class="btn btn-primary btn-sm me-2 mb-2" onclick="switchLanguage('zh')">
            中文 (zh)
          </button>
        </div>

        <!-- RTL Languages -->
        <div class="col-12 col-md-6">
          <h5>RTL Languages</h5>
          <button class="btn btn-success btn-sm me-2 mb-2" onclick="switchLanguage('ar')">
            العربية (ar)
          </button>
          <button class="btn btn-success btn-sm me-2 mb-2" onclick="switchLanguage('he')">
            עברית (he)
          </button>
          <button class="btn btn-success btn-sm me-2 mb-2" onclick="switchLanguage('fa')">
            فارسی (fa)
          </button>
          <button class="btn btn-success btn-sm me-2 mb-2" onclick="switchLanguage('ur')">
            اردو (ur)
          </button>
        </div>
      </div>
    </div>

    <!-- Sample Content -->
    <div class="demo-box">
      <h3>Sample Content</h3>
      <div class="row">
        <div class="col-12 col-md-4 mb-3">
          <div class="card h-100">
            <div class="card-body">
              <h5 class="card-title"><i class="bi bi-graph-up text-primary"></i> Innovation</h5>
              <p class="card-text">Leading technology advancement since 1968.</p>
              <a href="#" class="btn btn-sm btn-primary">Learn More</a>
            </div>
          </div>
        </div>
        <div class="col-12 col-md-4 mb-3">
          <div class="card h-100">
            <div class="card-body">
              <h5 class="card-title"><i class="bi bi-leaf text-success"></i> Sustainability</h5>
              <p class="card-text">Committed to environmental responsibility.</p>
              <a href="#" class="btn btn-sm btn-success">Learn More</a>
            </div>
          </div>
        </div>
        <div class="col-12 col-md-4 mb-3">
          <div class="card h-100">
            <div class="card-body">
              <h5 class="card-title"><i class="bi bi-people text-info"></i> Community</h5>
              <p class="card-text">Building a diverse and inclusive culture.</p>
              <a href="#" class="btn btn-sm btn-info">Learn More</a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Event Log -->
    <div class="demo-box">
      <h3>Event Log</h3>
      <div id="event-log" class="font-monospace small" style="max-height: 200px; overflow-y: auto; background: #f8f9fa; padding: 10px; border-radius: 4px;">
        <div>System initialized...</div>
      </div>
    </div>

    <!-- Google Translate Instructions -->
    <div class="alert alert-warning mt-4">
      <h5><i class="bi bi-google"></i> Testing with Google Translate</h5>
      <p>To test with Google Translate:</p>
      <ol>
        <li>Right-click anywhere on the page</li>
        <li>Select "Translate to [Language]"</li>
        <li>Watch the layout automatically adjust for RTL languages!</li>
      </ol>
      <p class="mb-0"><small>Supported RTL languages: Arabic, Hebrew, Persian, Urdu, and more.</small></p>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Auto-Detect Language & Adjust Layout Script -->
  <script>
    /**
     * Automatic RTL/LTR Language Detection and Layout Adjustment
     * Detects language changes (including Google Translate) and applies appropriate text direction
     */
    (function() {
      'use strict';

      // List of RTL language codes (ISO 639-1)
      const RTL_LANGUAGES = [
        'ar',  // Arabic
        'he',  // Hebrew
        'fa',  // Persian/Farsi
        'ur',  // Urdu
        'yi',  // Yiddish
        'iw',  // Hebrew (old code)
        'ji',  // Yiddish (old code)
        'ps',  // Pashto
        'sd',  // Sindhi
        'ug',  // Uyghur
        'ku',  // Kurdish (some dialects)
        'arc', // Aramaic
        'ckb', // Central Kurdish (Sorani)
        'dv'   // Dhivehi/Maldivian
      ];

      // Bootstrap CSS URLs
      const BOOTSTRAP_LTR = 'https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css';
      const BOOTSTRAP_RTL = 'https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css';

      // Cache DOM elements
      const htmlElement = document.documentElement;
      const bootstrapLink = document.getElementById('bootstrap-css');
      const eventLog = document.getElementById('event-log');

      /**
       * Log events to the demo display
       */
      function logEvent(message) {
        if (eventLog) {
          const timestamp = new Date().toLocaleTimeString();
          const logEntry = document.createElement('div');
          logEntry.textContent = `[${timestamp}] ${message}`;
          eventLog.appendChild(logEntry);
          eventLog.scrollTop = eventLog.scrollHeight;
        }
        console.log(message);
      }

      /**
       * Update the status display
       */
      function updateStatusDisplay(lang, dir, cssType) {
        const langEl = document.getElementById('current-lang');
        const dirEl = document.getElementById('current-dir');
        const cssEl = document.getElementById('current-css');
        const indicator = document.getElementById('status-indicator');

        if (langEl) langEl.textContent = lang;
        if (dirEl) dirEl.textContent = dir.toUpperCase();
        if (cssEl) cssEl.textContent = cssType;
        if (indicator) {
          indicator.className = 'status-indicator ' + (dir === 'rtl' ? 'status-rtl' : 'status-ltr');
        }
      }

      /**
       * Check if a language code represents an RTL language
       */
      function isRTLLanguage(langCode) {
        if (!langCode) return false;
        const primaryLang = langCode.toLowerCase().split('-')[0];
        return RTL_LANGUAGES.includes(primaryLang);
      }

      /**
       * Apply the appropriate text direction and Bootstrap CSS
       */
      function applyTextDirection(langCode) {
        const isRTL = isRTLLanguage(langCode);
        const newDir = isRTL ? 'rtl' : 'ltr';
        const currentDir = htmlElement.getAttribute('dir');

        // Only update if direction has changed
        if (currentDir !== newDir) {
          logEvent(`Language changed to: ${langCode} - Applying ${newDir.toUpperCase()} layout`);
          
          // Update dir attribute
          htmlElement.setAttribute('dir', newDir);
          
          // Swap Bootstrap CSS
          const newBootstrapURL = isRTL ? BOOTSTRAP_RTL : BOOTSTRAP_LTR;
          const cssType = isRTL ? 'RTL Bootstrap' : 'Standard (LTR) Bootstrap';
          
          if (bootstrapLink && bootstrapLink.href !== newBootstrapURL) {
            bootstrapLink.href = newBootstrapURL;
            bootstrapLink.removeAttribute('integrity');
            logEvent(`Switched to ${cssType}`);
          }

          updateStatusDisplay(langCode, newDir, cssType);

          // Dispatch custom event
          window.dispatchEvent(new CustomEvent('directionChanged', {
            detail: { direction: newDir, language: langCode }
          }));
        }
      }

      /**
       * Detect current page language
       */
      function detectLanguage() {
        let lang = htmlElement.getAttribute('lang');
        
        const googleTranslateFrame = document.querySelector('.goog-te-banner-frame');
        if (googleTranslateFrame) {
          lang = htmlElement.getAttribute('lang') || lang;
        }
        
        if (!lang) {
          lang = navigator.language || navigator.userLanguage || 'en';
        }
        
        return lang;
      }

      /**
       * Initialize the language detection
       */
      function initialize() {
        const currentLang = detectLanguage();
        applyTextDirection(currentLang);
        logEvent('Language detection initialized');
      }

      /**
       * Set up MutationObserver to watch for language changes
       */
      function setupLanguageObserver() {
        const observer = new MutationObserver(function(mutations) {
          mutations.forEach(function(mutation) {
            if (mutation.type === 'attributes' && mutation.attributeName === 'lang') {
              const newLang = htmlElement.getAttribute('lang');
              if (newLang) {
                applyTextDirection(newLang);
              }
            }
          });
        });

        observer.observe(htmlElement, {
          attributes: true,
          attributeFilter: ['lang']
        });

        logEvent('Language observer started');
      }

      /**
       * Setup Google Translate detection
       */
      function setupGoogleTranslateDetection() {
        const bodyObserver = new MutationObserver(function(mutations) {
          const translateWidget = document.querySelector('.goog-te-banner-frame, .goog-te-menu-frame');
          if (translateWidget) {
            logEvent('Google Translate detected');
            setTimeout(() => {
              const lang = detectLanguage();
              applyTextDirection(lang);
            }, 500);
          }
        });

        bodyObserver.observe(document.body, {
          childList: true,
          subtree: true
        });
      }

      /**
       * Manual language switching function
       */
      window.switchLanguage = function(langCode) {
        logEvent(`Manual switch to: ${langCode}`);
        htmlElement.setAttribute('lang', langCode);
        applyTextDirection(langCode);
      };

      // Initialize
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
          initialize();
          setupLanguageObserver();
          setupGoogleTranslateDetection();
        });
      } else {
        initialize();
        setupLanguageObserver();
        setupGoogleTranslateDetection();
      }

      logEvent('RTL/LTR Auto-Detection Script Loaded');
    })();
  </script>
</body>
</html>
